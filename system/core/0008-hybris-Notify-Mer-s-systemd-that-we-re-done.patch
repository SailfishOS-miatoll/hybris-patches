From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: David Greaves <david@dgreaves.com>
Date: Wed, 20 Nov 2013 19:24:31 +0000
Subject: [PATCH] (hybris) Notify Mer's systemd that we're done

Change-Id: If6a16f43397f00c8e579af79ae6cf8459786e7b3
Signed-off-by: David Greaves <david.greaves@jollamobile.com>
---
 rootdir/init.rc | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/rootdir/init.rc b/rootdir/init.rc
index ac3d280f2ef39f49176e2a6777b3bcf3e24bbbdf..8cdcb4101d8284d50e09fd55003b5cd11c767b95 100644
--- a/rootdir/init.rc
+++ b/rootdir/init.rc
@@ -1332,3 +1332,17 @@ on property:persist.device_config.mglru_native.lru_gen_config=core_and_nonleaf_y
   write /sys/kernel/mm/lru_gen/enabled 5
 on property:persist.device_config.mglru_native.lru_gen_config=all
   write /sys/kernel/mm/lru_gen/enabled 7
+
+# This trigger is run by our modified init after boot has finished
+on ready
+    class_start mer
+
+# Notify Mer's systemd that we're done
+# This is started at the end of boot after both core and main classes
+service droid_init_done /bin/sh /usr/bin/droid/droid-init-done.sh
+    class mer
+    oneshot
+
+# update recovery if enabled
+on property:persist.sys.recovery_update=true
+    start flash_recovery
