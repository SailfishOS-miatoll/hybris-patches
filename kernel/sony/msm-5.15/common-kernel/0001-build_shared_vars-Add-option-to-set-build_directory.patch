From 2ee6fe13784b5dca26e7e1ece980b6e2c45d2789 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Bidar?= <bjorn.bidar@jolla.com>
Date: Tue, 3 Nov 2020 19:47:26 +0200
Subject: [PATCH] build_shared_vars: Add option to set build_directory
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Bj√∂rn Bidar <bjorn.bidar@jolla.com>
---
 build_shared.sh      | 7 ++++++-
 build_shared_vars.sh | 6 ++++--
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/build_shared.sh b/build_shared.sh
index c297920..0315842 100644
--- a/build_shared.sh
+++ b/build_shared.sh
@@ -49,7 +49,12 @@ for platform in $PLATFORMS; do \
             dtb="-dtb"
         fi
 
-        KERNEL_TMP_PLATFORM=$KERNEL_TMP/${platform}
+        # Don't override $KERNEL_TMP when set by manually
+        if [ ! "$build_directory" ] ; then
+            KERNEL_TMP_PLATFORM=$KERNEL_TMP/${platform}
+        else
+            KERNEL_TMP_PLATFORM=${build_directory}
+        fi
         BUILD_ARGS_PLATFORM="$BUILD_ARGS O=$KERNEL_TMP_PLATFORM"
 
         # Keep kernel tmp when building for a specific platform or when using keep tmp
diff --git a/build_shared_vars.sh b/build_shared_vars.sh
index 0f76e38..22f5629 100644
--- a/build_shared_vars.sh
+++ b/build_shared_vars.sh
@@ -20,15 +20,17 @@ Usage: ${0##*/} [-k -p <platform>]
 Options:
 -k              keep kernel tmp after build
 -p <platform>   only build the kernel for <platform>
+-O <directory>  build kernel in <directory>
 EOF
 }
 
 
-arguments=khp:
+arguments=khp:O:
 while getopts $arguments argument ; do
     case $argument in
         k) keep_kernel_tmp=t ;;
         p) only_build_for=$OPTARG;;
+        O) build_directory=$OPTARG;;
         h) usage; exit 0;;
         ?) usage; exit 1;;
     esac
@@ -50,4 +52,4 @@ MKDTIMG=$ANDROID_ROOT/out/host/linux-x86/bin/mkdtimg
 KERNEL_TOP=$ANDROID_ROOT/kernel/sony/msm-5.15
 # $KERNEL_TMP sub dir per script
 c=${0##*-}
-KERNEL_TMP=$ANDROID_ROOT/out/kernel-5.15/${c%%.sh}
+KERNEL_TMP=${build_directory:-$ANDROID_ROOT/out/kernel-5.15/${c%%.sh}}
-- 
2.45.0

